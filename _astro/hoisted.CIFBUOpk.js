class v{constructor(e){this.root=e,this.gridEl=e.querySelector("[data-justified-grid]"),this.overlay=e.querySelector("[data-lightbox]"),this.imageEl=this.overlay?.querySelector("[data-lightbox-image]")||null,this.nameEl=this.overlay?.querySelector("[data-lightbox-name]")||null,this.descEl=this.overlay?.querySelector("[data-lightbox-desc]")||null,this.tagsWrapper=this.overlay?.querySelector("[data-lightbox-tags-wrapper]")||null,this.tagsContainer=this.overlay?.querySelector("[data-lightbox-tags]")||null,this.closeBtn=this.overlay?.querySelector("[data-lightbox-close]")||null,this.nextBtn=this.overlay?.querySelector("[data-lightbox-next]")||null,this.prevBtn=this.overlay?.querySelector("[data-lightbox-prev]")||null,this.items=this.parseItems(e.dataset.lightboxItems),this.targetHeight=Number(this.gridEl?.dataset.rowHeight)||400,this.gap=Number(this.gridEl?.dataset.rowGap)||12,this.triggers=[],this.activeIndex=0,this.previousOverflow="",this.handleKeyDown=this.handleKeyDown.bind(this),this.handleOverlayClick=this.handleOverlayClick.bind(this),this.handleCloseClick=this.handleCloseClick.bind(this),this.handleNextClick=this.handleNextClick.bind(this),this.handlePrevClick=this.handlePrevClick.bind(this),!(!this.gridEl||!this.items.length)&&(this.setupOverlayControls(),this.renderGrid(),typeof ResizeObserver<"u"&&(this.resizeObserver=new ResizeObserver(()=>{this.renderGrid()}),this.resizeObserver.observe(this.root)))}parseItems(e){if(!e)return[];try{const i=JSON.parse(decodeURIComponent(e));return Array.isArray(i)?i:[]}catch(i){return console.warn("Failed to parse justified gallery items",i),[]}}getAspect(e){const i=Number(e?.aspectRatio);if(Number.isFinite(i)&&i>0)return i;const t=Number(e?.width),r=Number(e?.height);return Number.isFinite(t)&&Number.isFinite(r)&&r>0?t/r:1.5}renderGrid(){if(!this.gridEl)return;const e=this.gridEl.clientWidth||this.gridEl.offsetWidth;if(!e){requestAnimationFrame(()=>this.renderGrid());return}this.gridEl.style.setProperty("--row-gap",`${this.gap}px`),this.gridEl.innerHTML="",this.triggers=[];const i=this.items,t=1.35,r=.7;let a=[],l=0;const n=s=>{if(!a.length)return;let c=(e-this.gap*(a.length-1))/l;const p=Math.max(this.targetHeight*r,Math.min(this.targetHeight*t,c)),g=s?this.targetHeight:p,d=document.createElement("div");d.className="justified-row",d.style.height=`${g}px`,s&&d.classList.add("justified-row--last"),a.forEach(u=>{const h=this.createTrigger(u.item,u.index);s?(h.style.flex="0 0 auto",h.style.width=`${g*u.aspect}px`,h.style.height=`${g}px`):(h.style.flex=`${u.aspect} 1 0`,h.style.height=`${g}px`),d.appendChild(h)}),this.gridEl.appendChild(d),a=[],l=0};i.forEach((s,m)=>{const c=this.getAspect(s);a.push({item:s,aspect:c,index:m}),l+=c,l*this.targetHeight+this.gap*(a.length-1)>=e&&n(!1)}),a.length&&n(!0),this.refreshNavVisibility()}createTrigger(e,i){const t=document.createElement("button");t.type="button",t.dataset.lightboxTrigger="",t.dataset.index=String(i),t.className="justified-item";const r=e.name||e.title,a=r?`Open ${r} in lightbox`:"Open image in lightbox";t.setAttribute("aria-label",a);const l=document.createElement("img");if(l.src=e.grid||e.preview||e.thumb,l.alt=e.name||e.title||"Gallery image",l.loading="lazy",l.decoding="async",t.appendChild(l),e.name||e.desc){const n=document.createElement("div");if(n.className="justified-item__overlay",e.name){const s=document.createElement("strong");s.className="justified-item__title",s.textContent=e.name,n.appendChild(s)}if(e.desc){const s=document.createElement("p");s.className="justified-item__desc",s.textContent=e.desc,n.appendChild(s)}t.appendChild(n)}return t.addEventListener("click",n=>{n.preventDefault(),this.openLightbox(i)}),this.triggers[i]=t,t}setupOverlayControls(){this.overlay&&(this.overlay.addEventListener("click",this.handleOverlayClick),this.closeBtn?.addEventListener("click",this.handleCloseClick),this.nextBtn?.addEventListener("click",this.handleNextClick),this.prevBtn?.addEventListener("click",this.handlePrevClick))}handleOverlayClick(e){e.target===this.overlay&&this.closeLightbox()}handleCloseClick(e){e.preventDefault(),this.closeLightbox()}handleNextClick(e){e.preventDefault(),this.step(1)}handlePrevClick(e){e.preventDefault(),this.step(-1)}handleKeyDown(e){this.overlay?.classList.contains("hidden")||(e.key==="Escape"?(e.preventDefault(),this.closeLightbox()):e.key==="ArrowRight"?(e.preventDefault(),this.step(1)):e.key==="ArrowLeft"&&(e.preventDefault(),this.step(-1)))}refreshNavVisibility(){!this.nextBtn||!this.prevBtn||(!this.items||this.items.length<2?(this.nextBtn.classList.add("hidden"),this.prevBtn.classList.add("hidden")):(this.nextBtn.classList.remove("hidden"),this.prevBtn.classList.remove("hidden")))}renderTags(e){if(!this.tagsContainer||!this.tagsWrapper)return;this.tagsContainer.innerHTML="";const i=Array.isArray(e)?e.filter(t=>t&&t.slug):[];if(i.length===0){this.tagsWrapper.classList.add("hidden");return}this.tagsWrapper.classList.remove("hidden"),i.forEach(t=>{const r=document.createElement("a");r.href=`/tag/${t.slug}`,r.textContent=`#${t.label||t.code||t.slug}`,r.className="lightbox-tag",this.tagsContainer.appendChild(r)})}updateOverlayContent(){const e=this.items[this.activeIndex];if(!e)return;const i=e.preview||e.grid||e.thumb;this.imageEl&&(i?this.imageEl.src!==i&&(this.imageEl.src=i):this.imageEl.removeAttribute("src"),this.imageEl.alt=e.name||e.title||"Gallery image"),this.nameEl&&(e.name?(this.nameEl.textContent=e.name,this.nameEl.classList.remove("hidden")):(this.nameEl.textContent="",this.nameEl.classList.add("hidden"))),this.descEl&&(e.desc?(this.descEl.textContent=e.desc,this.descEl.classList.remove("hidden")):(this.descEl.textContent="",this.descEl.classList.add("hidden"))),this.renderTags(e.tags)}openLightbox(e){!this.overlay||!this.items.length||(this.activeIndex=e,this.updateOverlayContent(),this.overlay.classList.remove("hidden"),this.overlay.setAttribute("aria-hidden","false"),this.previousOverflow=document.body.style.overflow,document.body.style.overflow="hidden",window.addEventListener("keydown",this.handleKeyDown),requestAnimationFrame(()=>{this.closeBtn?.focus()}))}closeLightbox(){if(!this.overlay||this.overlay.classList.contains("hidden"))return;this.overlay.classList.add("hidden"),this.overlay.setAttribute("aria-hidden","true"),document.body.style.overflow=this.previousOverflow,window.removeEventListener("keydown",this.handleKeyDown),this.triggers[this.activeIndex]?.focus({preventScroll:!0})}step(e){!this.items||this.items.length<2||(this.activeIndex=(this.activeIndex+e+this.items.length)%this.items.length,this.updateOverlayContent())}}const f=Array.from(document.querySelectorAll("[data-lightbox-root]"));f.forEach(o=>{o.dataset.lightboxItems&&o.dataset.lightboxItems.length>0&&new v(o)});
