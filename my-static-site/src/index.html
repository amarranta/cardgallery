<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Card Gallery</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        body { margin:0; font-family:sans-serif; background:#f8f8f8; }
        #container { display:flex; height:100vh; }
        #folders { width:240px; background:#fff; border-right:1px solid #ddd; overflow-y:auto; padding:16px 0; }
        #folders ul { list-style:none; padding:0; margin:0; }
        #folders li { cursor:pointer; padding:8px 24px; border-radius:4px; margin-bottom:2px; }
        #folders li.active { background:#e0e7ff; font-weight:bold; }
        #gallery { flex:1; padding:24px; overflow-y:auto; }
        .folder-title { font-size:1.2em; margin-bottom:12px; color:#555; }
        .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:20px; }
        .card { background:#fff; border-radius:8px; box-shadow:0 2px 8px #0001; padding:12px; display:flex; flex-direction:column; align-items:center; }
        .card img { width:100%; max-width:220px; height:auto; border-radius:6px; margin-bottom:8px; background:#eee; }
        .card .title { font-weight:bold; margin-bottom:4px; }
        .card .desc { color:#666; font-size:0.95em; margin-bottom:6px; }
        .card .folder { font-size:0.85em; color:#888; }
        @media (max-width:600px) {
            #container { flex-direction:column; }
            #folders { width:100%; border-right:none; border-bottom:1px solid #ddd; }
            #gallery { padding:12px; }
        }
    </style>
</head>
<body>
    <div id="container">
        <nav id="folders"></nav>
        <main id="gallery"></main>
    </div>
    <script>
        let galleryData = null;
        let currentFolder = null;

        function createFolderTree(folders, root) {
            const ul = document.createElement('ul');
            Object.keys(folders).sort().forEach(folder => {
                const li = document.createElement('li');
                li.textContent = folder.replace(new RegExp('^' + root + '/?'), '') || '(root)';
                li.dataset.folder = folder;
                li.onclick = () => showFolder(folder);
                if (folder === currentFolder) li.classList.add('active');
                ul.appendChild(li);
            });
            return ul;
        }

        function showFolder(folder) {
            currentFolder = folder;
            document.querySelectorAll('#folders li').forEach(li => {
                li.classList.toggle('active', li.dataset.folder === folder);
            });
            const items = galleryData.folders[folder] || [];
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            const title = document.createElement('div');
            title.className = 'folder-title';
            title.textContent = folder.replace(new RegExp('^' + galleryData.root + '/?'), '') || '(root)';
            gallery.appendChild(title);

            const grid = document.createElement('div');
            grid.className = 'grid';
            items.forEach(it => {
                const card = document.createElement('div');
                card.className = 'card';
                const a = document.createElement('a');
                a.href = it.url;
                a.target = '_blank';
                a.rel = 'noopener';
                const img = document.createElement('img');
                img.src = it.thumb;
                img.alt = it.title || it.description || it.public_id;
                img.loading = 'lazy';
                a.appendChild(img);
                card.appendChild(a);

                if (it.title) {
                    const t = document.createElement('div');
                    t.className = 'title';
                    t.textContent = it.title;
                    card.appendChild(t);
                }
                if (it.description) {
                    const d = document.createElement('div');
                    d.className = 'desc';
                    d.textContent = it.description;
                    card.appendChild(d);
                }
                const f = document.createElement('div');
                f.className = 'folder';
                f.textContent = folder.replace(new RegExp('^' + galleryData.root + '/?'), '');
                card.appendChild(f);

                grid.appendChild(card);
            });
            gallery.appendChild(grid);
        }

        fetch('gallery.json')
            .then(r => r.json())
            .then(data => {
                galleryData = data;
                const foldersNav = document.getElementById('folders');
                foldersNav.innerHTML = '';
                foldersNav.appendChild(createFolderTree(data.folders, data.root));
                // Show first folder or root
                const firstFolder = Object.keys(data.folders)[0] || data.root;
                showFolder(firstFolder);
            })
            .catch(err => {
                document.getElementById('gallery').textContent = 'Failed to load gallery.';
                console.error(err);
            });
    </script>
</body>
</html>