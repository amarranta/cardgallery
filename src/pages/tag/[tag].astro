---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Sidebar from '../../components/Sidebar.astro';
import ProfileHero from '../../components/ProfileHero.astro';
import ViewHeader from '../../components/ViewHeader.astro';
import ImageGrid from '../../components/ImageGrid.astro';
import TagList from '../../components/TagList.astro';
import { getAlbums, getTags, getTagPaths, getTagBySlug, hero, site } from '../../data/gallery.js';

export function getStaticPaths() {
  return getTagPaths().map(({ params }) => ({
    params,
    props: { tag: getTagBySlug(params.tag) }
  }));
}

const { tag } = Astro.props;
const albums = getAlbums();
const tags = getTags();

if (!tag) {
  throw new Error('Tag data missing for requested path.');
}

const subtitle = `${tag.items.length} ${tag.items.length === 1 ? 'photo' : 'photos'}`;
---
<BaseLayout title={`${tag.label} â€¢ ${site.title}`} description={`Tag ${tag.label} on ${site.title}`}>
  <div class="flex min-h-screen flex-col lg:flex-row">
    <Sidebar albums={albums} tags={tags} activeTag={tag.slug} />
    <main class="flex flex-1 flex-col overflow-hidden">
      <ProfileHero {...hero} />
  <ViewHeader title={tag.label} subtitle={subtitle} backHref={import.meta.env.BASE_URL} backLabel="Back to albums" />
      <ImageGrid items={tag.items} />
      {tags.length > 0 && (
        <section class="pb-12">
          <h3 class="px-6 text-sm font-semibold uppercase tracking-[0.3em] text-[var(--text-muted)] md:px-9">
            Browse other tags
          </h3>
          <TagList tags={tags} activeTag={tag.slug} />
        </section>
      )}
    </main>
  </div>
</BaseLayout>
