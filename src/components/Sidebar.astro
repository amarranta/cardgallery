---
import { filterVisibleTags } from '../data/tag-visibility.js';

interface SidebarAlbum {
  slug: string;
  name: string;
  items: { thumbUrl?: string }[];
}

interface SidebarTag {
  slug: string;
  label: string;
}

interface SidebarProps {
  albums?: SidebarAlbum[];
  tags?: SidebarTag[];
  activeAlbum?: string | null;
  activeTag?: string | null;
  activeCollection?: 'folders' | 'postcards';
}

const {
  albums = [],
  tags = [],
  activeAlbum = null,
  activeTag = null,
  activeCollection = 'folders'
} = Astro.props as SidebarProps;
const visibleTags = filterVisibleTags(tags);
---
<aside class="hidden bg-sidebar border-r border-sidebar px-6 py-7 w-72 flex-col gap-6 lg:flex">
  <a href={`${import.meta.env.BASE_URL}about`} class="flex flex-col items-center gap-3 group">
    <div class="h-28 w-28 overflow-hidden rounded-full border-4 border-avatar shadow-surface transition group-hover:border-accent">
      <img src={`${import.meta.env.BASE_URL}assets/img/amarantha-avatar.jpg`} alt="Portrait of amarantha with her dog" class="h-full w-full object-cover" />
    </div>
    <span class="text-sm font-semibold transition group-hover:text-accent" data-i18n="nav.aboutMe">About me</span>
  </a>
  <nav class="flex flex-col gap-6">
    <div>
      <p class="text-xs uppercase tracking-[0.2em] text-muted mb-3" data-i18n="nav.browse">Browse</p>
      <ul class="flex flex-col gap-2">
        <li>
            <a class={`flex items-center gap-2 rounded-md px-4 py-3 text-base font-semibold transition hover:bg-sidebar-hover ${activeCollection === 'folders' && !activeAlbum && !activeTag ? 'bg-sidebar-active text-accent' : ''}`} href={import.meta.env.BASE_URL}>
            <span data-i18n="nav.allFolders">All folders</span>
          </a>
        </li>
        <li>
          <a
            class={`flex items-center gap-2 rounded-sm px-3 py-2 text-sm font-semibold transition hover:bg-sidebar-hover ${activeCollection === 'postcards' ? 'bg-sidebar-active text-accent' : ''}`}
            href={`${import.meta.env.BASE_URL}postcards`}
          >
            <span data-i18n="nav.allPostcards">All postcards</span>
          </a>
        </li>
        {albums.map(album => (
          <li>
            <a
              class={`flex items-center gap-2 rounded-sm px-3 py-2 text-sm font-semibold transition hover:bg-sidebar-hover ${activeAlbum === album.slug ? 'bg-sidebar-active text-accent' : ''}`}
              href={`${import.meta.env.BASE_URL}album/${album.slug}`}
            >
              <span data-i18n={`albums.${album.name}`}>{album.name}</span>
              <span class="ml-auto text-xs font-medium text-muted">{album.items.length}</span>
            </a>
          </li>
        ))}
      </ul>
    </div>
    <div>
      <p class="text-xs uppercase tracking-[0.2em] text-muted mb-3" data-i18n="nav.tags">Tags</p>
      <ul class="flex flex-col gap-2">
        {visibleTags.length === 0 && (
          <li class="text-sm text-muted" data-i18n="nav.tagsEmpty">Tags will appear once available.</li>
        )}
        {visibleTags.map(tag => (
          <li>
            <a
              class={`block rounded-sm px-3 py-2 text-sm font-medium transition hover:bg-sidebar-hover ${activeTag === tag.slug ? 'bg-sidebar-tag border border-sidebar-strong text-accent' : 'border border-transparent'}`}
              href={`${import.meta.env.BASE_URL}tag/${tag.slug}`}
              data-i18n={`tags.${tag.label}`}
            >
              {tag.label}
            </a>
          </li>
        ))}
      </ul>
    </div>
  </nav>
  <div class="mt-auto rounded-md border border-sidebar-strong bg-sidebar-hover px-4 py-3 text-sm font-semibold text-primary">
    <a href={`${import.meta.env.BASE_URL}map`} class="flex items-center gap-2 transition hover:text-accent">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 6l6-3 6 3 6-3v15l-6 3-6-3-6 3z" />
        <path d="M9 3v15" />
        <path d="M15 6v15" />
      </svg>
      <span>My postcard map</span>
    </a>
  </div>
</aside>
